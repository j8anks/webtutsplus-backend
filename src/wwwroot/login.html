<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
  
    <!-- https://codepen.io/Strusovsky/pen/GxWPvJ -->
    
    <link rel="stylesheet" type="text/css" href="css/default.css">    
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script defer src="main.js"></script>

</head>
<body>      
    <div class="signin">
      <div class="back-img">
        <div class="sign-in-text">
          <h2 class="active">Sign In</h2>
          <h2 class="nonactive">Sign Up</h2>
        </div><!--/.sign-in-text-->
        <div class="layer">
        </div><!--/.layer-->
        <p class="point">&#9650;</p>
      </div><!--/.back-img-->
      <div class="form-section">
       
        <form action="#">
          <!--Email--> 
          <!-- type="email"  -->
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <input class="mdl-textfield__input" type="text" id="username" value="jbanks">
            <label class="mdl-textfield__label" for="sample3">Email</label>
            <!-- <span class="mdl-textfield__error">Enter a correct Email</span> -->
          </div>
          <br/>
          <br/>
          <!--Password-->
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <input pattern=".{5,}" class="mdl-textfield__input" type="password" id="password" value="sealteam6>">
            <label class="mdl-textfield__label" for="sample3">Password</label>
            <span class="mdl-textfield__error">Minimum 8 characters</span>
          </div>
          <br/>
          <p class="forgot-text">Forgot Password ?</p>
          <!--CheckBox-->
          <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-1">
          <input type="checkbox" id="checkbox-1" class="mdl-checkbox__input" checked>
          <span class="keep-text mdl-checkbox__label">Keep me Signed In</span>
        </label>
        </form>
      </div><!--/.form-section-->
      
      <button class="sign-in-btn mdl-button mdl-js-ripple-effect mdl-js-button mdl-button--raised mdl-button--colored"
      onclick="getAuthToken()">
        Sign In
      </button><!--/button-->
   </div><!--/.signin-->



   <script>    
   
    
   // make the request to the login endpoint
  function getAuthToken() {
    
    var loginUrl = "https://localhost:7188/api/Account/GetToken";
    var xhr = new XMLHttpRequest();
    var userElement = document.getElementById('username');
    var passwordElement = document.getElementById('password');
    var tokenElement = document.getElementById('token');
    var user = userElement.value;
    var password = passwordElement.value;
    var grant_type = 'password';
    sessionStorage.setItem("token", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJJZCI6IjY3YjA0NWFlLWEzNTMtNGQxNC04MmRlLWYxNGZmZjBlOWM3OCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL25hbWUiOiJqYmFua3MiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJqYmFua3NAcXdlc3Q0LmNvbSIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL25hbWVpZGVudGlmaWVyIjoiNmRjY2E5MDQtYmNhMC00ZjExLTkwZjItNjY2MGYwYTYwNzNmIiwiRW50aXR5SWQiOiI3VVlKTUZQYzNWbSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvZXhwaXJhdGlvbiI6Ikp1bCBNb24gMTEgMjAyMiAxODoyNzozNiBQTSIsIm5iZiI6MTY1NzQ3NzY1NiwiZXhwIjoxNjU3NTgyMDU2LCJpc3MiOiJodHRwczovL2xvY2FsaG9zdDo3MTg4IiwiYXVkIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NzE4OCJ9.YHgEWU_9OT1Sb6MHr8fV4jsgT5r3C-pAM8beLzcPTtM");
    xhr.open('POST', loginUrl, true);
    
    xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
    xhr.addEventListener('load', function() {
    var responseObject = JSON.parse(this.response);
    console.log(responseObject);
    if (responseObject.token) {
      sessionStorage.setItem("token", responseObject.token);
      sessionStorage.setItem("userName", responseObject.userName);
      let myToken = sessionStorage.getItem("token");
      let expiresIn = responseObject.expires_in;            
      TokenExpiration(expiresIn);  
      window.location.href = domain; 
             
    } else {
      // handle.
      let test = null;
    }
    });
      
      let strData =JSON.stringify({
        username: user,
        password: password,
        });
      var sendObject = strData;       
    xhr.send(sendObject);
  }

  function TokenExpiration(expiresIn) {    
    var now = new Date();
    tokenExpires = new Date(now.getTime() + expiresIn*1000);
    sessionStorage.setItem("tokenExpires", tokenExpires)   
  }

  </script>

  </body>
</html>